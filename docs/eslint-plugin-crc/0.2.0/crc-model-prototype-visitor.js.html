<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>crc-model-prototype-visitor.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CrcModel.html">CrcModel</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModel.html#.factory">factory</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CrcModelFormatter.html">CrcModelFormatter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelFormatter.html#format">format</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CrcModelList.html">CrcModelList</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelList.html#filterBy">filterBy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelList.html#find">find</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelList.html#getPrototypeOf">getPrototypeOf</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelList.html#groupBy">groupBy</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CrcModelPrototypeVisitor.html">CrcModelPrototypeVisitor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelPrototypeVisitor.html#getPrototypeByClassExtends">getPrototypeByClassExtends</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelPrototypeVisitor.html#getPrototypeByNewExpression">getPrototypeByNewExpression</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelPrototypeVisitor.html#getPrototypeByObjectCreate">getPrototypeByObjectCreate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelPrototypeVisitor.html#visit">visit</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CrcModelVisitor.html">CrcModelVisitor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelVisitor.html#.getCrcModelOptions">getCrcModelOptions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelVisitor.html#.getModelDeclaredInRange">getModelDeclaredInRange</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelVisitor.html#.inOwnDeclarationScope">inOwnDeclarationScope</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CrcModelVisitor.html#.isDeclaration">isDeclaration</a></span></li><li class="nav-heading">Interfaces</li><li class="nav-heading"><span class="nav-item-type type-interface">I</span><span class="nav-item-name"><a href="CrcModelListVisitor.html">CrcModelListVisitor</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#generateReport">generateReport</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#preprocessShebangs">preprocessShebangs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#saveToFile">saveToFile</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">crc-model-prototype-visitor.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const CrcModelListVisitor = require('./crc-model-list-visitor');
const { find, first, forEach, get, set } = require('lodash');
const templates = require('require-dir')('./templates', {
    recurse: true,
    camelcase: true
});

/**
 * Identifies the `prototype` of each `CrcModel` in a `CrcModelList`.
 * @implements {CrcModelListVisitor}
 */
class CrcModelPrototypeVisitor extends CrcModelListVisitor {
    /**
   *
   * Find a `CrcModel`'s prototype when expressed with `Object.create`
   *
   * @param {CrcModel} crcModel  The `CrcModel` whose prototype you need.
   * @param {CrcModelList} crcModelList The array of `CrcModels` to which the `CrcModel` in question belongs.
   *
   * @returns {CrcModel|Error} The `CrcModel`'s prototype or an `Error` if a prototype does not exist for it.'
   */
    getPrototypeByObjectCreate(crcModel, crcModelList) {
        // Definition 1: Object.create
        let crcPrototype;
        try {
            let predicate = set(
                templates.getPrototypeOfExpressionStatement,
                'expression.left.object.name',
                crcModel.name
            );
            const expressionStatement = find(crcModelList.ast.body, predicate);
            predicate = templates.getPrototypeOfMemberExpression;
            const memberExpression =
              find(expressionStatement.expression.right.arguments, predicate);
            const name = get(memberExpression, 'object.name');
            crcPrototype = crcModelList.find({name});
        }
        catch (err) {
            crcPrototype = err;
        }
        return crcPrototype;
    }

    /**
   *
   * Find a `CrcModel`'s prototype when expressed with `extends`.
   *
   * @param {CrcModel} crcModel  The `CrcModel` whose prototype you need.
   * @param {CrcModelList} crcModelList The array of `CrcModels` to which the `CrcModel` in question belongs.
   *
   * @returns {CrcModel|Error} The `CrcModel`'s prototype or an `Error` if a prototype does not exist for it.'
   */
    getPrototypeByClassExtends(crcModel, crcModelList) {
        // Definition 3: class extends
        let crcPrototype;
        try {
            const predicate = set(templates.getPrototypeOfClassExpression, 'id.name', crcModel.name);
            const classDeclaration = find(crcModelList.ast.body, predicate);
            const name = get(classDeclaration, 'superClass.name');
            crcPrototype = crcModelList.find({name});
        }
        catch (err) {
            crcPrototype = err;
        }
        return crcPrototype;
    }

    /**
   *
   * Find a `CrcModel`'s prototype when expressed with the `new` keyword.
   *
   * @param {CrcModel} crcModel  The `CrcModel` whose prototype you need.
   * @param {CrcModelList} crcModelList The array of `CrcModels` to which the `CrcModel` in question belongs.
   *
   * @returns {CrcModel|Error} The `CrcModel`'s prototype or an `Error` if a prototype does not exist for it.'
   */
    getPrototypeByNewExpression(crcModel, crcModelList) {
        let crcPrototype;
        try {
            const predicate = templates.getPrototypeOfNewExpression;
            first(predicate.declarations).id.name = crcModel.name;
            const newExpression = find(crcModelList.ast.body, predicate);
            const name = get(
                first(newExpression.declarations),
                'init.callee.name'
            );
            crcPrototype = crcModelList.find({name}).superClass;
        }
        catch (err) {
            crcPrototype = err;
        }
        return crcPrototype;
    }

    /**
   *
   * Traverses a `CrcModelList`'s AST to find and assign object prototypes
   * to each `CrcModel#superClass` property.
   * @augments CrcModelListVisitor#visit
   *
   * @param {CrcModelList} crcModelList An array of `CrcModels`.
   *
   * @returns {undefined}
   */
    visit(crcModelList) {
        forEach(crcModelList.models, (model) => {
            const prototype = crcModelList.getPrototypeOf(model);
            model.superClass = prototype;
        });
    }
}

module.exports = CrcModelPrototypeVisitor;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Nov 13 2017 09:11:46 GMT-0600 (CST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
